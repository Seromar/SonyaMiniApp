<!-- modules/module3/lesson2.html -->

<style>
    /* Локальные стили для урока */
    .lesson-container {
        max-height: 80vh; /* Ограничение высоты контейнера для прокрутки */
        overflow-y: auto; /* Добавление вертикальной прокрутки */
        padding-right: 10px; /* Отступ для полосы прокрутки */
    }

    h2 {
        text-align: center;
        color: #fff;
    }

    .section {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .section h3 {
        margin-top: 0;
        color: #333;
    }

    .section p,
    .section li {
        color: #333;
    }

    /* Таблицы */
    .section table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    .section th, .section td {
        border: 1px solid #ccc;
        padding: 8px;
    }
    .section th {
        background-color: #f2f2f2;
        text-align: left;
    }

    /* Кнопка для проверки */
    .submit-btn {
        display: inline-block;
        padding: 10px;
        background-color: #8e2de2;
        color: #fff;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        margin: 10px 0;
        transition: background-color 0.3s ease;
    }
    .submit-btn:hover {
        background-color: #4a00e0;
    }

    /* Поля ввода и фидбек */
    .quiz-question {
        margin-bottom: 15px;
    }
    .quiz-question label {
        display: block;
        margin-bottom: 5px;
        color: #333;
    }
    .quiz-question input[type="text"] {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    .quiz-question select {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    .feedback {
        margin-top: 20px;
        padding: 15px;
        border-radius: 10px;
        display: none;
    }
    .feedback.success {
        background-color: #d4edda;
        color: #155724;
    }
    .feedback.error {
        background-color: #f8d7da;
        color: #721c24;
    }

    /* Радиокнопки */
    .radio-group {
        margin-left: 20px;
    }
    .radio-group input[type="radio"] {
        margin-right: 8px;
    }

    /* Drag & Drop */
    .drag-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    .draggable {
        padding: 8px 12px;
        background-color: #ffc107;
        border-radius: 8px;
        cursor: move;
        user-select: none;
    }
    .drop-zone {
        flex: 1 1 100%;
        min-height: 50px;
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 10px;
        transition: border-color 0.3s;
    }
    .drop-zone.dragover {
        border-color: #28a745; /* Зеленый при наведении */
    }

    /* Кнопка "Назад" (иконка Font Awesome или любая другая) */
    .back-button {
        display: flex;
        align-items: center;
        gap: 5px;
        background-color: #ffe4c4;
        color: #000;
        padding: 10px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 20px;
        text-decoration: none;
        width: 120px;
        justify-content: center;
        transition: background-color 0.3s;
    }
    .back-button:hover {
        background-color: #ffc299;
    }
    .back-icon {
        width: 20px;
        height: 20px;
    }
</style>

<div class="lesson-container">
    <h2>Урок 4: Passive Voice in Complex Structures (Страдательный залог в сложных конструкциях)</h2>

    <!-- Кнопка "Назад" -->
    <button class="back-button" onclick="window.history.back()">
        <img src="back.png" alt="Назад" class="back-icon">
        Назад
    </button>

    <!-- 1. Введение в страдательный залог -->
    <div class="section">
        <h3>Введение в страдательный залог</h3>
        <p>Страдательный залог (Passive Voice) используется, когда акцент делается на действии или объекте действия, а не на субъекте. В сложных конструкциях страдательный залог помогает создавать более формальные и разнообразные предложения.</p>
    </div>

    <!-- 2. Формирование страдательного залога -->
    <div class="section">
        <h3>Формирование страдательного залога</h3>
        <table>
            <thead>
                <tr>
                    <th>Время</th>
                    <th>Форма страдательного залога</th>
                    <th>Пример</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Present Simple</td>
                    <td>am/is/are + past participle</td>
                    <td>The book is read by many people.</td>
                </tr>
                <tr>
                    <td>Past Simple</td>
                    <td>was/were + past participle</td>
                    <td>The cake was baked by Sarah.</td>
                </tr>
                <tr>
                    <td>Future Simple</td>
                    <td>will be + past participle</td>
                    <td>The project will be completed by next week.</td>
                </tr>
                <tr>
                    <td>Present Perfect</td>
                    <td>has/have been + past participle</td>
                    <td>The documents have been signed.</td>
                </tr>
                <tr>
                    <td>Past Perfect</td>
                    <td>had been + past participle</td>
                    <td>The report had been submitted before the deadline.</td>
                </tr>
                <tr>
                    <td>Modal Verbs</td>
                    <td>modal + be + past participle</td>
                    <td>The building must be inspected regularly.</td>
                </tr>
            </tbody>
        </table>
        <p>В сложных конструкциях страдательный залог позволяет объединять разные времена и модальные глаголы для выражения различных оттенков смысла.</p>
    </div>

    <!-- 3. Задание 1: Заполните пропуски (Passive Voice) -->
    <div class="section">
        <h3>Задание 1: Заполните пропуски (Passive Voice)</h3>
        <p>Заполните пропуски правильной формой страдательного залога:</p>
        <div class="quiz-question">
            <label>1. The bridge _______ (build) by a renowned engineer.</label>
            <input type="text" id="pv1" placeholder="Например: was built">
        </div>
        <div class="quiz-question">
            <label>2. The new policy _______ (implement) next month.</label>
            <input type="text" id="pv2" placeholder="Например: will be implemented">
        </div>
        <button class="submit-btn" onclick="checkPassiveVoice()">Проверить</button>
        <div class="feedback" id="passivevoice-feedback"></div>
    </div>

    <!-- 4. Задание 2: Сопоставьте время и форму -->
    <div class="section">
        <h3>Задание 2: Сопоставьте время и форму страдательного залога</h3>
        <div class="quiz-question">
            <label>1. Present Perfect</label>
            <select id="pv_match1">
                <option value="">Выберите форму</option>
                <option value="has been delivered">has been delivered</option>
                <option value="is delivered">is delivered</option>
                <option value="was delivered">was delivered</option>
            </select>
        </div>
        <div class="quiz-question">
            <label>2. Past Simple</label>
            <select id="pv_match2">
                <option value="">Выберите форму</option>
                <option value="have been canceled">have been canceled</option>
                <option value="was canceled">was canceled</option>
                <option value="will be canceled">will be canceled</option>
            </select>
        </div>
        <button class="submit-btn" onclick="checkPassiveMatching()">Проверить</button>
        <div class="feedback" id="passivematching-feedback"></div>
    </div>

    <!-- 5. Задание 3: Тест с радиокнопками (Passive Structures) -->
    <div class="section">
        <h3>Задание 3: Определите форму страдательного залога</h3>
        <p>Выберите правильную форму страдательного залога:</p>
        <div class="quiz-question">
            <label>1. "The meal ___ by the chef."</label>
            <div class="radio-group">
                <label><input type="radio" name="pv3" value="is prepared">is prepared</label><br>
                <label><input type="radio" name="pv3" value="has prepared">has prepared</label><br>
                <label><input type="radio" name="pv3" value="was preparing">was preparing</label>
            </div>
        </div>
        <div class="quiz-question">
            <label>2. "The meeting ___ by the manager last week."</label>
            <div class="radio-group">
                <label><input type="radio" name="pv4" value="is held">is held</label><br>
                <label><input type="radio" name="pv4" value="was held">was held</label><br>
                <label><input type="radio" name="pv4" value="will be held">will be held</label>
            </div>
        </div>
        <button class="submit-btn" onclick="checkPassiveQuiz()">Проверить</button>
        <div class="feedback" id="passivequiz-feedback"></div>
    </div>

    <!-- 6. Задание 4: Drag & Drop (Passive Structures) -->
    <div class="section">
        <h3>Задание 4: Соберите предложение в страдательном залоге</h3>
        <p>Соберите предложение: <em>"The results have been analyzed by the research team."</em></p>
        <div class="drag-container">
            <div class="draggable" draggable="true">the</div>
            <div class="draggable" draggable="true">results</div>
            <div class="draggable" draggable="true">have</div>
            <div class="draggable" draggable="true">been</div>
            <div class="draggable" draggable="true">analyzed</div>
            <div class="draggable" draggable="true">by</div>
            <div class="draggable" draggable="true">the</div>
            <div class="draggable" draggable="true">research</div>
            <div class="draggable" draggable="true">team.</div>
        </div>
        <div class="drop-zone" id="drop-zone-pv"></div>
        <button class="submit-btn" onclick="checkPassiveDrag()">Проверить</button>
        <div class="feedback" id="passivedrag-feedback"></div>
    </div>

    <!-- 7. Задание 5: Перепишите предложения (Advanced Passive Structures) -->
    <div class="section">
        <h3>Задание 5: Перепишите предложения в страдательный залог</h3>
        <p>Перепишите предложения в страдательный залог:</p>
        <ol>
            <li>
                "The company will launch a new product next month."
                <br><input type="text" id="pv_rw1" placeholder='Например: A new product will be launched by the company next month.'>
            </li>
            <li>
                "Researchers have discovered a new species in the Amazon rainforest."
                <br><input type="text" id="pv_rw2" placeholder='Например: A new species has been discovered by researchers in the Amazon rainforest.'>
            </li>
            <li>
                "They are renovating the old library this year."
                <br><input type="text" id="pv_rw3" placeholder='Например: The old library is being renovated by them this year.'>
            </li>
        </ol>
        <button class="submit-btn" onclick="checkPassiveRewrite()">Проверить</button>
        <div class="feedback" id="passiverewrite-feedback"></div>
    </div>
</div>

<script>
    /************************************************************
     * Задание 1: Passive Voice
     ************************************************************/
    function checkPassiveVoice() {
        // Примеры эталонных ответов
        // pv1 -> "was built"
        // pv2 -> "will be implemented"

        let correct = [
            { 
                id: 'pv1', 
                structure: [
                    "was built",
                    "is built",
                    "were built"
                ] 
            },
            {
                id: 'pv2', 
                structure: [
                    "will be implemented",
                    "is implemented",
                    "are implemented"
                ]
            }
        ];

        let score = 0;
        correct.forEach(item => {
            let user = document.getElementById(item.id).value.trim().toLowerCase();
            user = user.replace(/\./g,''); // Удаляем точки
            if (item.structure.includes(user)) {
                score++;
                document.getElementById(item.id).style.border = '2px solid #28a745';
            } else {
                document.getElementById(item.id).style.border = '2px solid #dc3545';
            }
        });

        const feedback = document.getElementById('passivevoice-feedback');
        feedback.style.display = 'block';
        if (score === correct.length) {
            feedback.className = 'feedback success';
            feedback.textContent = 'Отлично! Страдательный залог сформирован правильно.';
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Правильных ответов: ${score} из ${correct.length}. Проверьте формы глаголов.`;
        }
    }

    /************************************************************
     * Задание 2: Passive Voice Matching
     ************************************************************/
    function checkPassiveMatching() {
        // pv_match1: Present Perfect -> "has been delivered"
        // pv_match2: Past Simple -> "was canceled"

        let answers = { pv_match1: 'has been delivered', pv_match2: 'was canceled' };
        let score = 0;
        let total = 2;

        for (let key in answers) {
            let user = document.getElementById(key).value;
            if (user === answers[key]) {
                score++;
                document.getElementById(key).style.borderColor = '#28a745';
            } else {
                document.getElementById(key).style.borderColor = '#dc3545';
            }
        }

        const feedback = document.getElementById('passivematching-feedback');
        feedback.style.display = 'block';
        if (score === total) {
            feedback.className = 'feedback success';
            feedback.textContent = 'Отлично! Вы правильно сопоставили времена и формы страдательного залога.';
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Правильных ответов: ${score} из ${total}. Попробуйте снова.`;
        }
    }

    /************************************************************
     * Задание 3: Radio Quiz (Passive Structures)
     ************************************************************/
    function checkPassiveQuiz() {
        // pv3 -> "is prepared"
        // pv4 -> "was held"

        const correct = { pv3: 'is prepared', pv4: 'was held' };
        let total = 2;
        let score = 0;

        // pv3
        let userAnswer3 = '';
        document.getElementsByName('pv3').forEach(radio => {
            if (radio.checked) userAnswer3 = radio.value;
        });
        if (userAnswer3 === correct.pv3) score++;

        // pv4
        let userAnswer4 = '';
        document.getElementsByName('pv4').forEach(radio => {
            if (radio.checked) userAnswer4 = radio.value;
        });
        if (userAnswer4 === correct.pv4) score++;

        const feedback = document.getElementById('passivequiz-feedback');
        feedback.style.display = 'block';

        if (score === total) {
            feedback.className = 'feedback success';
            feedback.textContent = `Отличная работа! Все ответы верны (${score}/${total}).`;
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Правильных ответов: ${score} из ${total}. Попробуйте ещё раз.`;
        }
    }

    /************************************************************
     * Задание 4: Drag & Drop (Passive Structures)
     ************************************************************/
    const dragItemsPV = document.querySelectorAll('.draggable');
    const dropZonePV = document.getElementById('drop-zone-pv');
    let dragSourcePV = null;

    dragItemsPV.forEach(item => {
        item.addEventListener('dragstart', handleDragStartPV);
        item.addEventListener('dragend', handleDragEndPV);
    });
    dropZonePV.addEventListener('dragover', handleDragOverPV);
    dropZonePV.addEventListener('drop', handleDropPV);

    function handleDragStartPV(e) {
        dragSourcePV = e.target;
        e.dataTransfer.setData('text/plain', e.target.textContent);
        e.target.style.opacity = '0.4';
    }
    function handleDragEndPV(e) {
        e.target.style.opacity = '1';
    }
    function handleDragOverPV(e) {
        e.preventDefault();
        dropZonePV.classList.add('dragover');
    }
    function handleDropPV(e) {
        e.preventDefault();
        dropZonePV.classList.remove('dragover');
        if (dragSourcePV) {
            dropZonePV.appendChild(dragSourcePV);
            dragSourcePV = null;
        }
    }

    function checkPassiveDrag() {
        // "The results have been analyzed by the research team."
        const words = Array.from(dropZonePV.querySelectorAll('.draggable')).map(el => el.textContent.toLowerCase());
        let userSentence = words.join(' ');

        const correctSentence = "the results have been analyzed by the research team.";
        const feedback = document.getElementById('passivedrag-feedback');
        feedback.style.display = 'block';

        if (userSentence === correctSentence) {
            feedback.className = 'feedback success';
            feedback.textContent = 'Превосходно! Страдательный залог собран правильно.';
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Не совсем так. Получилось: "${userSentence}". Исправьте порядок слов.`;
        }
    }

    /************************************************************
     * Задание 5: Passive Voice Rewrite
     ************************************************************/
    function checkPassiveRewrite() {
        // Примеры правильных вариантов:
        // 1) "A new product will be launched by the company next month."
        // 2) "A new species has been discovered by researchers in the Amazon rainforest."
        // 3) "The old library is being renovated by them this year."

        let user1 = document.getElementById('pv_rw1').value.trim().toLowerCase();
        let user2 = document.getElementById('pv_rw2').value.trim().toLowerCase();
        let user3 = document.getElementById('pv_rw3').value.trim().toLowerCase();

        let score = 0;
        let total = 3;

        // Первый: "A new product will be launched by the company next month."
        if (user1 === "a new product will be launched by the company next month" ||
            user1 === "a new product will be launched by the company next month.") {
            score++;
            document.getElementById('pv_rw1').style.border = '2px solid #28a745';
        } else {
            document.getElementById('pv_rw1').style.border = '2px solid #dc3545';
        }

        // Второй: "A new species has been discovered by researchers in the Amazon rainforest."
        if (user2 === "a new species has been discovered by researchers in the amazon rainforest" ||
            user2 === "a new species has been discovered by researchers in the amazon rainforest.") {
            score++;
            document.getElementById('pv_rw2').style.border = '2px solid #28a745';
        } else {
            document.getElementById('pv_rw2').style.border = '2px solid #dc3545';
        }

        // Третий: "The old library is being renovated by them this year."
        if (user3 === "the old library is being renovated by them this year" ||
            user3 === "the old library is being renovated by them this year.") {
            score++;
            document.getElementById('pv_rw3').style.border = '2px solid #28a745';
        } else {
            document.getElementById('pv_rw3').style.border = '2px solid #dc3545';
        }

        const feedback = document.getElementById('passiverewrite-feedback');
        feedback.style.display = 'block';
        if (score === total) {
            feedback.className = 'feedback success';
            feedback.textContent = 'Отлично! Все предложения переписаны в страдательный залог правильно.';
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Правильных ответов: ${score} из ${total}. Проверьте структуру предложений.`;
        }
    }
</script>