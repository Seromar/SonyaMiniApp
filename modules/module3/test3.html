<!-- modules/module3/test3.html -->

<style>
    /* Локальные стили для теста */
    .test-container {
        max-height: 80vh;
        overflow-y: auto;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
    }

    h2 {
        text-align: center;
        color: #fff;
    }

    .section {
        margin-bottom: 20px;
    }

    .section h3 {
        color: #333;
    }

    .quiz-question {
        margin-bottom: 15px;
    }

    .quiz-question label {
        display: block;
        margin-bottom: 5px;
        color: #333;
    }

    .quiz-question input[type="text"],
    .quiz-question select {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .radio-group {
        margin-left: 20px;
    }
    .radio-group input[type="radio"] {
        margin-right: 8px;
    }

    .feedback {
        margin-top: 20px;
        padding: 15px;
        border-radius: 10px;
        display: none;
    }
    .feedback.success {
        background-color: #d4edda;
        color: #155724;
    }
    .feedback.error {
        background-color: #f8d7da;
        color: #721c24;
    }

    .submit-btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #28a745;
        color: #fff;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .submit-btn:hover {
        background-color: #218838;
    }

    /* Кнопка "Назад" */
    .back-button {
        display: flex;
        align-items: center;
        gap: 5px;
        background-color: #ffe4c4;
        color: #000;
        padding: 10px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 20px;
        text-decoration: none;
        width: 120px;
        justify-content: center;
        transition: background-color 0.3s;
    }
    .back-button:hover {
        background-color: #ffc299;
    }
    .back-icon {
        width: 20px;
        height: 20px;
    }
</style>

<div class="test-container">
    <h2>Тест 3: Comprehensive Grammar Test (Комплексный грамматический тест)</h2>

    <!-- Кнопка "Назад" -->
    <button class="back-button" onclick="window.history.back()">
        <img src="back.png" alt="Назад" class="back-icon">
        Назад
    </button>

    <!-- 1. Задание 1: Fill in the blanks -->
    <div class="section">
        <h3>Задание 1: Заполните пропуски</h3>
        <p>Заполните пропуски правильными формами глаголов и конструкциями:</p>
        <div class="quiz-question">
            <label>1. What _______ (she need) is a new computer.</label>
            <input type="text" id="cg1" placeholder="Например: she needs">
        </div>
        <div class="quiz-question">
            <label>2. If I _______ (be) you, I _______ (take) that opportunity.</label>
            <input type="text" id="cg2" placeholder="Например: were, would take">
        </div>
        <div class="quiz-question">
            <label>3. They _______ (have) completed the task by now.</label>
            <input type="text" id="cg3" placeholder="Например: must have">
        </div>
        <button class="submit-btn" onclick="checkComprehensiveGrammarTest()">Проверить</button>
        <div class="feedback" id="comprehensivegrammar-test-feedback"></div>
    </div>

    <!-- 2. Задание 2: Sentence Transformation -->
    <div class="section">
        <h3>Задание 2: Преобразование предложений</h3>
        <p>Преобразуйте предложения с использованием инверсии или эмфатических конструкций:</p>
        <ol>
            <li>
                "She has rarely visited museums."
                <br><input type="text" id="cg_rw1" placeholder="Например: Rarely has she visited museums.">
            </li>
            <li>
                "They have only one goal."
                <br><input type="text" id="cg_rw2" placeholder="Например: All they have is one goal.">
            </li>
            <li>
                "If he had studied harder, he would pass the exam."
                <br><input type="text" id="cg_rw3" placeholder="Например: If he had studied harder, he would pass the exam.">
            </li>
        </ol>
        <button class="submit-btn" onclick="checkSentenceTransformationTest3()">Проверить</button>
        <div class="feedback" id="sentencetransformationtest3-feedback"></div>
    </div>

    <!-- 3. Задание 3: Modal Verbs in Complex Structures -->
    <div class="section">
        <h3>Задание 3: Модальные глаголы в сложных конструкциях</h3>
        <p>Выберите правильный модальный глагол для завершения предложения:</p>
        <div class="quiz-question">
            <label>1. She _______ have been the one to solve the problem.</label>
            <select id="cg_modal1">
                <option value="">Выберите модальный глагол</option>
                <option value="could">could</option>
                <option value="must">must</option>
                <option value="should">should</option>
            </select>
        </div>
        <div class="quiz-question">
            <label>2. _______ you lend me some money?</label>
            <select id="cg_modal2">
                <option value="">Выберите модальный глагол</option>
                <option value="Can">Can</option>
                <option value="Must">Must</option>
                <option value="Shall">Shall</option>
            </select>
        </div>
        <div class="quiz-question">
            <label>3. If you _______ (have) more experience, you _______ (get) the job.</label>
            <input type="text" id="cg_modal3" placeholder="Например: had, would get">
        </div>
        <button class="submit-btn" onclick="checkModalVerbsTest3()">Проверить</button>
        <div class="feedback" id="modalverbs_test3-feedback"></div>
    </div>
</div>

<script>
    /************************************************************
     * Задание 1: Заполните пропуски
     ************************************************************/
    function checkComprehensiveGrammarTest() {
        // cg1 -> "she needs"
        // cg2 -> "were, would take"
        // cg3 -> "must have"

        let correct = [
            { 
                id: 'cg1', 
                answer: 'she needs' 
            },
            {
                id: 'cg2', 
                structure: [
                    "were, would take",
                    "were, would take."
                ] 
            },
            {
                id: 'cg3', 
                answer: 'must have'
            }
        ];

        let score = 0;

        // cg1
        let user1 = document.getElementById('cg1').value.trim().toLowerCase();
        if (user1 === correct[0].answer) {
            score++;
            document.getElementById('cg1').style.border = '2px solid #28a745';
        } else {
            document.getElementById('cg1').style.border = '2px solid #dc3545';
        }

        // cg2
        let user2 = document.getElementById('cg2').value.trim().toLowerCase();
        if (correct[1].structure.includes(user2)) {
            score++;
            document.getElementById('cg2').style.border = '2px solid #28a745';
        } else {
            document.getElementById('cg2').style.border = '2px solid #dc3545';
        }

        // cg3
        let user3 = document.getElementById('cg3').value.trim().toLowerCase();
        if (user3 === correct[2].answer) {
            score++;
            document.getElementById('cg3').style.border = '2px solid #28a745';
        } else {
            document.getElementById('cg3').style.border = '2px solid #dc3545';
        }

        const feedback = document.getElementById('comprehensivegrammar-test-feedback');
        feedback.style.display = 'block';
        if (score === correct.length) {
            feedback.className = 'feedback success';
            feedback.textContent = 'Отлично! Все пропуски заполнены правильно.';
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Правильных ответов: ${score} из ${correct.length}. Проверьте формы глаголов и конструкции.`;
        }
    }

    /************************************************************
     * Задание 2: Sentence Transformation
     ************************************************************/
    function checkSentenceTransformationTest3() {
        // cg_rw1: "Rarely has she visited museums."
        // cg_rw2: "All they have is one goal."
        // cg_rw3: "If he had studied harder, he would pass the exam."

        let user1 = document.getElementById('cg_rw1').value.trim().toLowerCase();
        let user2 = document.getElementById('cg_rw2').value.trim().toLowerCase();
        let user3 = document.getElementById('cg_rw3').value.trim().toLowerCase();

        let score = 0;
        let total = 3;

        // Первый
        if (user1 === "rarely has she visited museums" ||
            user1 === "rarely has she visited museums.") {
            score++;
            document.getElementById('cg_rw1').style.border = '2px solid #28a745';
        } else {
            document.getElementById('cg_rw1').style.border = '2px solid #dc3545';
        }

        // Второй
        if (user2 === "all they have is one goal" ||
            user2 === "all they have is one goal.") {
            score++;
            document.getElementById('cg_rw2').style.border = '2px solid #28a745';
        } else {
            document.getElementById('cg_rw2').style.border = '2px solid #dc3545';
        }

        // Третий
        if (user3 === "if he had studied harder, he would pass the exam" ||
            user3 === "if he had studied harder he would pass the exam.") {
            score++;
            document.getElementById('cg_rw3').style.border = '2px solid #28a745';
        } else {
            document.getElementById('cg_rw3').style.border = '2px solid #dc3545';
        }

        const feedback = document.getElementById('sentencetransformationtest3-feedback');
        feedback.style.display = 'block';
        if (score === total) {
            feedback.className = 'feedback success';
            feedback.textContent = 'Отлично! Все предложения преобразованы правильно.';
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Правильных ответов: ${score} из ${total}. Проверьте преобразование предложений.`;
        }
    }

    /************************************************************
     * Задание 3: Modal Verbs in Complex Structures
     ************************************************************/
    function checkModalVerbsTest3() {
        // cg_modal1 -> "must"
        // cg_modal2 -> "Can"
        // cg_modal3 -> "had, would get"

        let correct = [
            { 
                id: 'cg_modal1', 
                answer: 'must' 
            },
            {
                id: 'cg_modal2', 
                answer: 'Can' 
            },
            {
                id: 'cg_modal3', 
                structure: [
                    "had, would get",
                    "had, would get."
                ]
            }
        ];

        let score = 0;

        // cg_modal1
        let user1 = document.getElementById('cg_modal1').value;
        if (user1 === correct[0].answer) {
            score++;
            document.getElementById('cg_modal1').style.borderColor = '#28a745';
        } else {
            document.getElementById('cg_modal1').style.borderColor = '#dc3545';
        }

        // cg_modal2
        let user2 = document.getElementById('cg_modal2').value;
        if (user2 === correct[1].answer) {
            score++;
            document.getElementById('cg_modal2').style.borderColor = '#28a745';
        } else {
            document.getElementById('cg_modal2').style.borderColor = '#dc3545';
        }

        // cg_modal3
        let user3 = document.getElementById('cg_modal3').value.trim().toLowerCase();
        if (correct[2].structure.includes(user3)) {
            score++;
            document.getElementById('cg_modal3').style.border = '2px solid #28a745';
        } else {
            document.getElementById('cg_modal3').style.border = '2px solid #dc3545';
        }

        const feedback = document.getElementById('modalverbs_test3-feedback');
        feedback.style.display = 'block';
        if (score === correct.length) {
            feedback.className = 'feedback success';
            feedback.textContent = 'Отлично! Все модальные глаголы выбраны правильно.';
        } else {
            feedback.className = 'feedback error';
            feedback.textContent = `Правильных ответов: ${score} из ${correct.length}. Проверьте модальные глаголы и их конструкции.`;
        }
    }
</script>